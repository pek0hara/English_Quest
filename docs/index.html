<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unity English Word Learning App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f6f8fa;
            color: #24292e;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        #status-text {
            font-size: 1.2em;
            font-weight: bold;
            color: #0366d6;
        }

        #timer-text {
            font-size: 1.5em;
            color: #d73a49;
        }

        #game-container {
            background: #fff;
            padding: 20px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .slot {
            height: 60px;
            background-color: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .card {
            width: 100%;
            height: 100%;
            background-color: #fff;
            border: 1px solid #d1d5da;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            user-select: none;
            transition: background-color 0.2s;
        }

        .card.draggable {
            cursor: grab;
        }

        .card.draggable:active {
            cursor: grabbing;
        }

        .card.correct {
            background-color: #dcffe4;
            border-color: #28a745;
            color: #22863a;
        }

        .card.incorrect {
            background-color: #ffeef0;
            border-color: #d73a49;
            color: #cb2431;
        }

        .card.selected {
            border: 2px solid #0366d6;
            background-color: #e6f7ff;
            transform: scale(1.05);
            z-index: 10;
        }

        .slot.drag-over {
            background-color: #e6ffed;
            border-color: #2ea44f;
            border-style: solid;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            font-size: 1.1em;
            background-color: #2ea44f;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #94d3a2;
            cursor: not-allowed;
        }

        button:hover:not(:disabled) {
            background-color: #2c974b;
        }

        hr {
            border: 0;
            border-top: 1px solid #eaecef;
            margin: 30px 0;
        }

        .documentation h1, .documentation h2, .documentation h3 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        /* Mobile adjustment */
        @media (max-width: 500px) {
            .grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .slot {
                height: 50px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>English Word Learning Game</h1>
        <p id="status-text">Loading...</p>
        <p id="timer-text">Time: 10</p>
    </header>

    <div id="game-container">
        <div class="grid" id="grid"></div>
        <button id="check-btn" onclick="checkAnswer()" disabled>Check Answer</button>
        <div style="text-align: center; margin-top: 10px;">
            <button onclick="resetGame()" style="background-color: #0366d6; width: auto; display: inline-block; padding: 5px 15px; font-size: 0.9em;">Reset</button>
        </div>
    </div>

    <hr>

    <div style="text-align: center; margin: 30px 0;">
        <a href="about.html" style="font-size: 1.1em; color: #0366d6; text-decoration: none;">View App Documentation / Instructions</a>
    </div>

    <script>
        const wordsData = [
            { jp: "りんご", en: "Apple" },
            { jp: "本", en: "Book" },
            { jp: "猫", en: "Cat" },
            { jp: "犬", en: "Dog" },
            { jp: "卵", en: "Egg" },
            { jp: "魚", en: "Fish" },
            { jp: "女の子", en: "Girl" },
            { jp: "手", en: "Hand" },
            { jp: "氷", en: "Ice" },
            { jp: "ジャンプ", en: "Jump" },
            { jp: "凧", en: "Kite" },
            { jp: "ライオン", en: "Lion" },
            { jp: "月", en: "Moon" },
            { jp: "鼻", en: "Nose" },
            { jp: "オレンジ", en: "Orange" }
        ];

        let cards = [];
        let timer = 10;
        let timerInterval;
        let gameState = 'MEMORIZE'; // MEMORIZE, SOLVE, RESULT
        let selectedCard = null;

        const grid = document.getElementById('grid');
        const statusText = document.getElementById('status-text');
        const timerText = document.getElementById('timer-text');
        const checkBtn = document.getElementById('check-btn');

        let draggedCard = null;

        function initGame() {
            // Reset state
            gameState = 'MEMORIZE';
            timer = 10;
            cards = [];
            grid.innerHTML = '';
            checkBtn.disabled = true;
            statusText.textContent = "Memorize the positions!";
            timerText.textContent = "Time: " + timer;

            // Create slots and cards
            wordsData.forEach((word, index) => {
                // Create Slot
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.dataset.index = index;

                // Drop events
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('dragenter', handleDragEnter);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('drop', handleDrop);

                // Create Card
                const card = document.createElement('div');
                card.className = 'card';
                card.textContent = word.jp;
                card.dataset.originalIndex = index;
                card.draggable = false; // Disabled during memorize

                // Drag events
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);

                // Click event for tap-to-swap
                card.addEventListener('click', handleCardClick);

                cards.push(card);
                slot.appendChild(card);
                grid.appendChild(slot);
            });

            // Start Timer
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                timerText.textContent = "Time: " + timer;
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    startSolvePhase();
                }
            }, 1000);
        }

        function startSolvePhase() {
            gameState = 'SOLVE';
            statusText.textContent = "Arrange the English words!";
            checkBtn.disabled = false;

            // Switch to English
            cards.forEach(card => {
                const index = parseInt(card.dataset.originalIndex);
                card.textContent = wordsData[index].en;
                card.draggable = true;
                card.classList.add('draggable');
            });

            shuffleCards();
        }

        function shuffleCards() {
            // Fisher-Yates shuffle
            const shuffledCards = [...cards];
            for (let i = shuffledCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledCards[i], shuffledCards[j]] = [shuffledCards[j], shuffledCards[i]];
            }

            // Append to slots in new order
            const slots = document.querySelectorAll('.slot');
            slots.forEach((slot, i) => {
                if (slot.firstChild) {
                    slot.removeChild(slot.firstChild);
                }
                slot.appendChild(shuffledCards[i]);
            });
        }

        function handleDragStart(e) {
            if (gameState !== 'SOLVE') return;

            // Clear any selected card if dragging starts
            if (selectedCard) {
                selectedCard.classList.remove('selected');
                selectedCard = null;
            }

            draggedCard = this;
            e.dataTransfer.effectAllowed = 'move';
            this.style.opacity = '0.4';
        }

        function handleDragOver(e) {
            if (gameState !== 'SOLVE') return;
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            if (gameState !== 'SOLVE') return;
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            if (gameState !== 'SOLVE') return;
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (gameState !== 'SOLVE') return;
            e.preventDefault();
            this.classList.remove('drag-over');

            const targetSlot = this;
            if (!draggedCard) return;

            // Get the card currently in the target slot (if any)
            const targetCard = targetSlot.querySelector('.card');
            const originalSlot = draggedCard.parentElement;

            if (targetSlot === originalSlot) return;

            if (targetCard) {
                // Swap: Move targetCard to originalSlot
                if (originalSlot) {
                    originalSlot.appendChild(targetCard);
                }
            }

            // Move draggedCard to targetSlot
            targetSlot.appendChild(draggedCard);
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            draggedCard = null;
        }

        function handleCardClick(e) {
            if (gameState !== 'SOLVE') return;

            const clickedCard = e.currentTarget;

            // If no card selected, select this one
            if (!selectedCard) {
                selectedCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            // If clicked same card, deselect
            if (selectedCard === clickedCard) {
                selectedCard.classList.remove('selected');
                selectedCard = null;
                return;
            }

            // If different card, swap
            const sourceSlot = selectedCard.parentElement;
            const targetSlot = clickedCard.parentElement;

            // Swap the cards in the DOM
            if (sourceSlot && targetSlot) {
                sourceSlot.appendChild(clickedCard);
                targetSlot.appendChild(selectedCard);
            }

            // Clear selection and styling
            selectedCard.classList.remove('selected');
            selectedCard = null;
        }

        function checkAnswer() {
            if (gameState !== 'SOLVE') return;

            let correctCount = 0;
            const slots = document.querySelectorAll('.slot');

            slots.forEach(slot => {
                const card = slot.querySelector('.card');
                const slotIndex = parseInt(slot.dataset.index);

                if (card) {
                    const originalIndex = parseInt(card.dataset.originalIndex);

                    if (originalIndex === slotIndex) {
                        correctCount++;
                        card.classList.add('correct');
                        card.classList.remove('incorrect');
                    } else {
                        card.classList.add('incorrect');
                        card.classList.remove('correct');
                    }
                }
            });

            statusText.textContent = `Result: ${correctCount} / ${wordsData.length} Correct!`;
            gameState = 'RESULT';
            checkBtn.disabled = true;
            cards.forEach(card => {
                card.draggable = false;
                card.classList.remove('draggable');
            });
        }

        function resetGame() {
            clearInterval(timerInterval);
            initGame();
        }

        // Start game on load
        window.onload = initGame;

    </script>
</body>
</html>
